# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Commands

```bash
bun run dev       # Start dev server on port 3000
bun run build     # Build for production (outputs to .output/)
bun run preview   # Preview production build
bun run test      # Run tests with Vitest
```

**Package manager:** Bun (not npm/yarn).

**Environment:** Copy `.env.example` to `.env` and set `ANTHROPIC_API_KEY`.

## Architecture

This is a full-stack React app built with **TanStack Start** (SSR framework on top of Vite + Nitro). The app guides users through a life-strategy questionnaire and generates a personalized strategy using Claude AI via streaming.

**Stack:**
- **Frontend:** React 19, TanStack Router (file-based routing), Tailwind CSS 4
- **Backend:** Nitro server (runs alongside the React app in the same process)
- **AI:** `@anthropic-ai/sdk` — Claude Opus 4.6 with adaptive thinking
- **Build:** Vite, Bun

**Import alias:** `@/` maps to `./src/` (configured in both `tsconfig.json` and via `vite-tsconfig-paths`).

## Data Flow

```
/ (index.tsx)          — Landing page
  ↓
/questionnaire          — 6-step form; saves answers to sessionStorage
  ↓
/strategy               — Reads sessionStorage, POSTs to /api/strategy,
                          streams markdown response and renders it live
  ↓
/api/strategy (server)  — TanStack Start API route; calls Claude Opus
                          with adaptive thinking (max 8192 tokens),
                          streams text chunks back
```

## Routing

Routes live in `src/routes/` and are auto-discovered by the TanStack Router Vite plugin. The generated route tree is at `src/routes/routeTree.gen.ts` — **do not edit this file manually**; it is regenerated on `dev`/`build`.

- `src/routes/__root.tsx` — root layout (wraps all pages)
- `src/routes/api/strategy.ts` — the only backend API endpoint; runs server-side only

## Key Files

| File | Purpose |
|------|---------|
| `src/routes/api/strategy.ts` | Claude API integration, streaming logic, system prompt |
| `src/routes/questionnaire.tsx` | All 23 form fields across 6 steps |
| `src/routes/strategy.tsx` | Streaming display + markdown rendering |
| `src/components/Header.tsx` | Nav with mobile sidebar |
| `vite.config.ts` | Plugin order matters: nitro → tsconfigPaths → tailwind → tanstackStart → react |
